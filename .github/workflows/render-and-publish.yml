name: Render and Publish Quarto

on:
  push:
  branches:
  - main
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch: 

jobs:
  render-and-publish:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
    # Step 1: Check out the repository
    - name: Check out repository
      uses: actions/checkout@v3

    # Step 2: Set up R environment
    - name: Set up R
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.4.0' 

    # Step 3: Install Quarto CLI
    - name: Install Quarto CLI
      uses: quarto-dev/quarto-actions/setup@v2

    # Step 4: Install required R packages
    - name: Install R packages
      run: |
        Rscript -e 'install.packages(c("tidyverse", "sf", "here", "ggtext", "ggiraph", "scales"), dependencies = TRUE)'

    # Step 5: Render and deploy to GitHub Pages
    - name: Deploy to GitHub Pages
      uses: quarto-dev/quarto-actions/publish@v2
      with:
        target: gh-pages
        path: ./docs/new-year.qmd
      env:
        github_token: ${{ secrets.GITHUB_TOKEN }}
